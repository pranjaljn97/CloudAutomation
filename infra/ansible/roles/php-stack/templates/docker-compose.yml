#jinja2: lstrip_blocks: True
version: '2.0'
services:
  {% if env.mysql %}
   mysql:  
     image: mysql:5.7
     container_name: MYSQL 
     volumes:
       - ./mysql:/var/lib/mysql
     environment:
       MYSQL_ROOT_PASSWORD: {{ env.mysql.MYSQL_ROOT_PASSWORD }}
       MYSQL_DATABASE: {{ env.mysql.MYSQL_DATABASE }}
       MYSQL_USER: {{ env.mysql.MYSQL_USER }}
       MYSQL_PASSWORD: {{ env.mysql.MYSQL_PASSWORD }}
  {% endif %} 
  
  {% if env.mongodb %}
   mongodb:
     image: mongo
     container_name: MongoDB
     environment:
       MONGO_INTIDB_ROOT_USERNAME: {{ env.mongodb.MONGO_INITDB_ROOT_USERNAME }}
       MONGO_INTIDB_ROOT_PASSWORD: {{ env.mongodb.MONGO_INITDB_ROOT_PASSWORD }} 
     volumes:
       - ./mongodb:/data/db
  {% endif %}

   

  {% if env.redis %}
   redis:
     image: wodby/redis
     container_name: Redis 
     environment:
       REDIS_PASSWORD: {{ env.redis.REDIS_PASSWORD }} 
  {% endif %}

  
  {% if env.nginx_php %}
   nginx_php:
     image: wodby/php-nginx
     container_name: NGINX
     environment:
       NGINX_SERVER_ROOT: /var/www/html/
     depends_on:
       - php
     ports:
       - "8000:80"
     volumes:
      - code:/var/www/html


   php:
     image: wodby/php
     container_name: php
     environment:
       DB_USER: admin
       DB_PASSWORD: admin
       DB_NAME: wordpress
     volumes:
      - code:/var/www/html
          
  {% endif %}    
  
  {% if env.varnish %} 
   varnish:
     image: wodby/varnish
     container_name: Varnish
     environment:
       VARNISH_BACKEND_HOST: "NGINX"
       VARNISH_BACKEND_PORT: {{ env.varnish.VARNISH_BACKEND_PORT }}
     depends_on:
       - nginx_php
     ports:
       - "8050:6081"    

  {% endif %}

volumes:
    mysql:
    code:
    mongodb:

